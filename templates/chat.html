<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dobby Crypto Chat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root { --bg:#0f1216; --panel:#151a21; --panel-2:#1b222b; --border:#242b36; --text:#e7edf3; --muted:#9fb0c0; --accent:#5aa6ff; }
    body{background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;}
    .app{max-width:860px;margin:0 auto;display:flex;flex-direction:column;height:100dvh;padding:16px;gap:12px;}
    .header{display:flex;align-items:center;justify-content:space-between;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:10px 14px;}
    .title{font-weight:700;letter-spacing:.2px}
    .tray{display:flex;gap:8px;align-items:center}
    
    .composer{
      display:flex;
      flex-direction:column; 
      gap:10px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
    }
    .composer .main-input {
      display: flex;
      gap: 10px;
    }
    .composer textarea{
      resize:none;
      flex:1;
      background:var(--panel-2); 
      border:1px solid var(--border);
      border-radius: 10px;
      outline:none;
      color:var(--text);
      min-height: 52px; 
      padding: 12px;
    }
    .controls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items: center; 
      justify-content: flex-end; 
    }
    .select, .btn, .slider, .switch{
      background:var(--panel-2);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px 10px;
      font-size: 14px;
    }
    .btn{cursor:pointer}
    .btn-primary{background:linear-gradient(180deg,#2b6bff,#1946ac);border:none}

    .chat{flex:1;overflow:auto;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;scroll-behavior:smooth}
    .msg{max-width:80%;padding:12px 14px;border-radius:14px;margin:8px 0;line-height:1.35;border:1px solid var(--border); word-wrap: break-word;}
    .user{background:var(--panel-2);margin-left:auto}
    .ai{background:#0f1823}
    .meta{font-size:12px;color:var(--muted);margin-top:4px}
    .badge{background:#0f1823;border:1px solid var(--border);border-radius:20px;padding:6px 10px;color:var(--muted)}
    .typing{display:inline-block;min-width:40px}
    .dot{display:inline-block;width:6px;height:6px;background:#8bb4ff;border-radius:50%;margin:0 2px;animation:blink 1.3s infinite}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}
    a, a:visited{color:var(--accent)}
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title">Dobby Crypto Chat</div>
      <div class="tray">
        <span class="badge" id="trendBadge">trending: ...</span>
      </div>
    </div>

    <div class="composer">
      <div class="main-input">
        <textarea id="input" placeholder="Enter your topic... (e.g., in-depth analysis of the Billion x Sapien partnership)" rows="2"></textarea>
      </div>
      <div class="controls">
        <select id="style" class="select">
          <option value="meme">Meme</option>
          <option value="education">Education</option>
          <option value="engagement">Engagement</option>
        </select>
        <label class="switch select">
          <input id="proMode" type="checkbox"> ✨ Pro Mode
        </label>
        <label class="switch select">
          <input id="hashtags" type="checkbox"> Hashtags
        </label>
        <label class="select">
          <span class="me-2">Temp</span>
          <input id="temperature" type="range" min="0.2" max="1.2" step="0.1" value="0.8">
        </label>
        <button id="send" class="btn btn-primary">Send</button>
      </div>
    </div>

    <div id="chat" class="chat">
      </div>

  </div>

  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("send");
    const styleSel = document.getElementById("style");
    const proMode = document.getElementById("proMode");
    const hashtags = document.getElementById("hashtags");
    const temperature = document.getElementById("temperature");
    const trendBadge = document.getElementById("trendBadge");

    function el(tag, cls, text){
      const e = document.createElement(tag);
      if(cls) e.className = cls;
      if(text !== undefined) e.textContent = text;
      return e;
    }

    function addMsg(content, who="ai"){
      const wrap = el("div", "msg " + (who==="user"?"user":"ai"));
      wrap.innerText = content;
      chat.appendChild(wrap);
      chat.scrollTop = chat.scrollHeight;
    }

    function addTyping(){
      const wrap = el("div", "msg ai");
      wrap.id = "typing";
      const dots = el("span", "typing");
      dots.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      wrap.appendChild(dots);
      chat.appendChild(wrap);
      chat.scrollTop = chat.scrollHeight;
    }

    function removeTyping(){
      const t = document.getElementById("typing");
      if(t) t.remove();
    }

    async function send(){
      const message = input.value.trim();
      if(!message) return;
      
      input.disabled = true; sendBtn.disabled = true;
      addMsg(message, "user");
      addTyping();

      try{
        const res = await fetch("/chat", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({
            message,
            style: styleSel.value,
            proMode: proMode.checked,
            hashtags: hashtags.checked,
            temperature: parseFloat(temperature.value)
          })
        });
        const data = await res.json();
        removeTyping();
        
        if(data.trending){ 
          trendBadge.textContent = "trending: " + data.trending; 
        }
        
        if(data.replies && data.replies.length > 0){ 
          data.replies.forEach(reply => addMsg(reply, "ai"));
        } else if(data.error){ 
          addMsg("Error: " + data.error, "ai"); 
        }
      }catch(e){
        removeTyping();
        addMsg("Network error. Try again.", "ai");
      }finally{
        input.value = ""; 
        input.disabled = false; sendBtn.disabled = false;
        input.focus();
      }
    }

    sendBtn.addEventListener("click", send);
    input.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        send();
      }
    });

    addMsg("Welcome! I'm Dobby. By default, I generate short tweets (<=280 chars). For detailed, unlimited-length answers, activate ✨ Pro Mode.", "ai");
  </script>
</body>
</html>
